{% extends 'base.html' %}
{% load static %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Inter:wght@400;500&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<section class="relative w-full min-h-[600px] bg-cover bg-center"
         style="background-image: url('{% static 'image/hero1.jpg' %}');">
    <div class="absolute inset-0 bg-gradient-to-t from-gray-800/70 to-transparent"></div>

    <div class="relative z-10 flex flex-col h-full justify-between px-4 md:px-8 py-6">
        <!-- Back Button -->
        <div>
            <a href="{% url 'home' %}"
               class="group flex items-center space-x-2 hover:text-blue-300 font-medium text-sm md:text-base transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="w-5 h-5 text-black group-hover:text-blue-300"
                     fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                <span>Back to Home</span>
            </a>
        </div>
    <div class="relative z-10 flex flex-col justify-center items-center h-full px-4 py-8">
        <!-- Profile Card -->
        <div class="w-full max-w-2xl bg-white/90 rounded-xl shadow-md p-6"
             data-aos="fade-up" data-aos-duration="800">
            
            <!-- Tabs -->
            <div class="flex border-b border-gray-200 mb-6">
                <div class="flex-1 text-center py-3 font-semibold text-gray-800 cursor-pointer tab active bg-[#4285f4] text-white rounded-t-md"
                     onclick="showTab('profile')"
                     style="font-family: 'Poppins', sans-serif;">
                    Profile
                </div>
                <div class="flex-1 text-center py-3 font-semibold text-gray-800 cursor-pointer tab hover:bg-gray-100"
                     onclick="showTab('management')"
                     style="font-family: 'Poppins', sans-serif;">
                    Management
                </div>
            </div>

            <!-- Profile Section -->
            <div class="section" id="profile">
                <h1 class="text-2xl font-bold mb-6 text-center text-gray-800"
                    style="font-family: 'Poppins', sans-serif;">
                    My Profile
                </h1>

                <!-- Profile Info -->
                <div class="mb-4" data-aos="fade-up" data-aos-delay="100">
                    <h2 class="text-xl font-semibold text-gray-800"
                        style="font-family: 'Poppins', sans-serif;">
                        {{ user.username }}
                    </h2>
                    <p class="text-sm text-gray-600" style="font-family: 'Inter', sans-serif;">
                        {{ user.email|default:"No email set" }}
                    </p>
                    <p class="text-sm text-gray-600" style="font-family: 'Inter', sans-serif;">
                        Role: {{ user.get_role_display }}
                    </p>
                    <p class="text-sm text-gray-600" style="font-family: 'Inter', sans-serif;">
                        Phone: {{ user.phone|default:"Not set" }}
                    </p>
                </div>

                <!-- Tenant Information -->
                {% if user.role == 'tenant' and user.tenant %}
                <hr class="border-gray-200 my-6" data-aos="fade-up" data-aos-delay="200">
                <div class="mt-4" data-aos="fade-up" data-aos-delay="300">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3"
                        style="font-family: 'Poppins', sans-serif;">
                        Tenant Information
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-600"
                         style="font-family: 'Inter', sans-serif;">
                        <span class="font-medium text-gray-800">Budget:</span>
                        <span>{{ user.tenant.budget|default:"Not set" }}</span>
                        <span class="font-medium text-gray-800">Preferences:</span>
                        <span>{{ user.tenant.preferences|default:"Not set" }}</span>
                    </div>
                </div>
                {% endif %}

                <!-- Landlord Information -->
                {% if user.role == 'landlord' and user.landlord_profile %}
                <hr class="border-gray-200 my-6" data-aos="fade-up" data-aos-delay="400">
                <div class="mt-4" data-aos="fade-up" data-aos-delay="500">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3"
                        style="font-family: 'Poppins', sans-serif;">
                        Landlord Information
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-600"
                         style="font-family: 'Inter', sans-serif;">
                        <span class="font-medium text-gray-800">Phone Number:</span>
                        <span>{{ user.landlord_profile.phone_number|default:"Not set" }}</span>
                    </div>
                </div>
                {% endif %}

                <!-- Apply To Be landlord -->
                <hr class="border-gray-200 my-6">
                <div class="text-center" >
                    <a href="{% url 'apply_landlord' %}"
                       class="inline-block px-6 py-2 text-white bg-[#4285f4] hover:bg-blue-600 rounded-lg font-medium text-sm transition duration-300 shadow-sm hover:shadow-md"
                       style="font-family: 'Inter', sans-serif;">
                        Apply To Be landlord 
                    </a>
                </div>
            </div>

            <!-- Management Section -->
            <div class="section hidden" id="management">
                <div class="space-y-8">
                    {% if user.role == 'landlord' %}
                    <!-- Bookings Section for Landlord -->
                    {% if bookings %}
                    <div class="overflow-x-auto rounded-lg shadow-sm">
                        <table class="w-full text-sm text-gray-600 bg-white rounded-lg">
                            <thead>
                                <tr class="border-b border-gray-200 bg-gray-50">
                                    <th class="py-2 px-4 text-left font-semibold text-gray-800">Room</th>
                                    <th class="py-2 px-4 text-left font-semibold text-gray-800">Tenant</th>
                                    <th class="py-2 px-4 text-left font-semibold text-gray-800">Check-In</th>
                                    <th class="py-2 px-4 text-left font-semibold text-gray-800">Check-Out</th>
                                    <th class="py-2 px-4 text-left font-semibold text-gray-800">Status</th>
                                    <th class="py-2 px-4 text-left font-semibold text-gray-800">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for booking in bookings %}
                                <tr class="border-b border-gray-200 hover:bg-gray-50 transition duration-200">
                                    <td class="py-2 px-4">
                                        {{ booking.room.dorm_name }} - {{ booking.room.room_name }}
                                    </td>
                                    <td class="py-2 px-4">
                                        {{ booking.tenant.user.username|default:booking.full_name }}
                                    </td>
                                    <td class="py-2 px-4">
                                        {{ booking.check_in|date:"d M Y"|default:"Not set" }}
                                    </td>
                                    <td class="py-2 px-4">
                                        {{ booking.check_out|date:"d M Y"|default:"Not set" }}
                                    </td>
                                    <td class="py-2 px-4"
                                        {% if booking.status == 'pending' %}class="text-amber-400"
                                        {% elif booking.status == 'confirmed' %}class="text-emerald-400"
                                        {% elif booking.status == 'canceled' %}class="text-red-400"
                                        {% endif %}>
                                        {{ booking.status|title }}
                                    </td>
                                    <td class="py-2 px-4 flex space-x-2">
                                        {% if booking.status == 'pending' %}
                                        <a href="{% url 'booking_confirm' booking.id %}"
                                           class="bg-emerald-400 hover:bg-emerald-500 text-white py-1 px-3 rounded-lg text-sm font-medium transition duration-300 hover:shadow-md">
                                            Confirm
                                        </a>
                                        <a href="{% url 'booking_cancel' booking.id %}"
                                           class="bg-red-400 hover:bg-red-500 text-white py-1 px-3 rounded-lg text-sm font-medium transition duration-300 hover:shadow-md">
                                            Cancel
                                        </a>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    <!-- Rooms Section -->
                    <div id="rooms" class="space-y-4">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-2xl font-bold text-gray-800"
                                style="font-family: 'Poppins', sans-serif;">
                                My Rooms
                            </h2>
                            <a href="{% url 'room_create' %}"
                               class="inline-block px-6 py-2 text-white bg-[#4285f4] hover:bg-blue-600 rounded-lg font-medium text-sm transition duration-300 shadow-sm hover:shadow-md"
                               style="font-family: 'Inter', sans-serif;">
                                Add New Room
                            </a>
                        </div>

                        {% if rooms %}
                        <div class="overflow-x-auto rounded-lg shadow-sm">
                            <table class="w-full text-sm text-gray-600 bg-white rounded-lg">
                                <thead>
                                    <tr class="border-b border-gray-200 bg-gray-50">
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Dorm Name</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Room Name</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Price</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Lease Duration</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Available</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for room in rooms %}
                                    <tr class="border-b border-gray-200 hover:bg-gray-50 transition duration-200">
                                        <td class="py-2 px-4">{{ room.dorm_name }}</td>
                                        <td class="py-2 px-4">{{ room.room_name }}</td>
                                        <td class="py-2 px-4">{{ room.price }}</td>
                                        <td class="py-2 px-4">{{ room.lease_duration_months }} months</td>
                                        <td class="py-2 px-4">{{ room.available|yesno:"Yes,No" }}</td>
                                        <td class="py-2 px-4 flex space-x-2">
                                            <a href="{% url 'room_edit' room.id %}"
                                               class="bg-[#4285f4] hover:bg-blue-600 text-white py-1 px-3 rounded-lg text-sm font-medium transition duration-300 hover:shadow-md">
                                                Edit
                                            </a>
                                            <a href="{% url 'room_delete' room.id %}"
                                               class="bg-red-400 hover:bg-red-500 text-white py-1 px-3 rounded-lg text-sm font-medium transition duration-300 hover:shadow-md"
                                               onclick="return confirm('Are you sure you want to delete this room?')">
                                                Delete
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-center text-gray-500 text-sm" style="font-family: 'Inter', sans-serif;">
                            No rooms found. Add a room to get started!
                        </p>
                        {% endif %}
                    </div>

                    {% else %}
                    <!-- Tenant View -->
                    <div id="tenant-bookings" class="space-y-4">
                        <h2 class="text-2xl font-bold text-gray-800"
                            style="font-family: 'Poppins', sans-serif;">
                            Your Bookings
                        </h2>
                        {% if bookings %}
                        <div class="overflow-x-auto rounded-lg shadow-sm">
                            <table class="w-full text-sm text-gray-600 bg-white rounded-lg">
                                <thead>
                                    <tr class="border-b border-gray-200 bg-gray-50">
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Room</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Check-In</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Check-Out</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Status</th>
                                        <th class="py-2 px-4 text-left font-semibold text-gray-800">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for booking in bookings %}
                                    <tr class="border-b border-gray-200 hover:bg-gray-50 transition duration-200">
                                        <td class="py-2 px-4">
                                            {{ booking.room.dorm_name }} - {{ booking.room.room_name }}
                                        </td>
                                        <td class="py-2 px-4">
                                            {{ booking.check_in|date:"d M Y"|default:"Not set" }}
                                        </td>
                                        <td class="py-2 px-4">
                                            {{ booking.check_out|date:"d M Y"|default:"Not set" }}
                                        </td>
                                        <td class="py-2 px-4"
                                            {% if booking.status == 'pending' %}class="text-amber-400"
                                            {% elif booking.status == 'confirmed' %}class="text-emerald-400"
                                            {% elif booking.status == 'canceled' %}class="text-red-400"
                                            {% endif %}>
                                            {{ booking.status|title }}
                                        </td>
                                        <td class="py-2 px-4 flex space-x-2">
                                            {% if booking.status == 'pending' %}
                                            <a href="{% url 'booking_payment' booking.id %}"
                                               class="bg-amber-400 hover:bg-amber-500 text-white py-1 px-3 rounded-lg text-sm font-medium transition duration-300 hover:shadow-md">
                                                Pay
                                            </a>
                                            <a href="{% url 'booking_cancel' booking.id %}"
                                               class="bg-red-400 hover:bg-red-500 text-white py-1 px-3 rounded-lg text-sm font-medium transition duration-300 hover:shadow-md">
                                                Cancel
                                            </a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <p class="text-center text-gray-500 text-sm mt-3" style="font-family: 'Inter', sans-serif;">
                            Note: If check-in/check-out dates are not set, please contact the landlord to confirm your booking details.
                        </p>
                        {% else %}
                        <p class="text-center text-gray-500 text-sm" style="font-family: 'Inter', sans-serif;">
                            No bookings found.
                        </p>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function showTab(tabName) {
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active', 'bg-[#4285f4]', 'text-white', 'rounded-t-md');
            tab.classList.add('hover:bg-gray-100');
        });
        document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
        document.getElementById(tabName).classList.remove('hidden');
        const activeTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
        activeTab.classList.add('active', 'bg-[#4285f4]', 'text-white', 'rounded-t-md');
        activeTab.classList.remove('hover:bg-gray-100');
    }
</script>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
    AOS.init();
</script>
{% endblock %}